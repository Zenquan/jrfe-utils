!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["jrfe-utils"]={})}(this,function(e){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t){return s(e)||c(e,t)||f(e,t)||h()}function o(e){return u(e)||l(e)||f(e)||m()}function u(e){if(Array.isArray(e))return p(e)}function s(e){if(Array.isArray(e))return e}function l(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function c(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return n}}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=f(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}var y={css:"text/css",less:"text/css",gif:"image/gif",html:"text/html",ico:"image/x-icon",jpeg:"image/jpeg",jpg:"image/jpg",js:"text/javascript",json:"application/json",pdf:"application/pdf",png:"image/png",svg:"image/svg",swf:"application/x-shockwave-flash",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",wmv:"video/x-ms-wmv",wma:"video/x-ms-wma",xml:"text/xml"},v=function(){function e(){n(this,e)}return i(e,[{key:"lookup",value:function(e){var t=e.split("/"),n=t.length,r=t[n-1].match(/\.\S+/)[0].match(/[^.]+/)[0];return y[r]}}]),e}(),g=function(){function e(){n(this,e)}return i(e,[{key:"getRemotePic",value:function(e,t,n){return new Promise(function(r,i){window.URL=window.URL||window.webkitURL;var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.send(),a.onload=function(e){var a=e.target,o=a.status,u=a.response;if(4===a.readyState&&200===o){var s=u,l=document.createElement("img");l.classList.add(t);var c=new FileReader;c.readAsDataURL(s),c.onloadend=function(){var e=c.result;"base64"===n?r(e):(l.src=e,r(l))}}else i(o)}}).catch(function(e){console.log("error>>>",e)})}},{key:"isSupportWebp",value:function(){return!![].map&&0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}},{key:"getWebpImage",value:function(e,t){var n=new v,r=n.lookup(e);e+="!",this.isSupportWebp()&&(e+="image/jpeg"===r?"/format/webp":"/format/webp/lossless/true");for(var i=0,o=Object.entries(t);i<o.length;i++){var u=a(o[i],2),s=u[0],l=u[1];e+="/".concat(s,"/").concat(l)}return e}}]),e}(),b={maxSpeed:10,minSpeed:3,spaceRatio:20,danmakuLength:5},w={},k=function(){function e(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n(this,e),"object"!==t(r))throw new Error("传入非法el");if(!i.length)return console.log("没有需要滚动的弹幕");this.option=Object.assign(b,a);var o=this.option.danmakuLength,u=r.getBoundingClientRect();this.$el=r,this.elWidth=u.width,this.elHeight=u.height,this.data=i,this.danmaku=i.splice(0,o),this.aliveItems=[],this.deatdItems=[],this.init()}return i(e,[{key:"init",value:function(){for(;this.danmaku.length;){var e=this.danmaku.shift(),t=this.createDom(e);this.aliveItems.push(t),this.$el.appendChild(t),this.setDomPosition(t),this.setDomSpeed(t)}this.animationTimer()}},{key:"createDom",value:function(e){var t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("img");return r.src=e.faceUrl,n.innerHTML=e.title,t.appendChild(r),t.appendChild(n),t}},{key:"setDomPosition",value:function(e){Math.random()>.5?e.setAttribute("class","danmaku-item one"):e.setAttribute("class","danmaku-item two");var t=e.getBoundingClientRect(),n=t.height,r=this.option.spaceRatio,i=parseInt(Math.random()*((this.elHeight-n)/r)),a=i*r;e.style="top: ".concat(a,"px;transform: translateX(").concat(this.elWidth+50,"px)")}},{key:"setDomSpeed",value:function(e){var t=this.option,n=t.maxSpeed,r=t.minSpeed,i=parseInt(Math.random()*(n-r)+r),a=(this.elWidth/(60*i)).toFixed(3);e.setAttribute("data-speed",a)}},{key:"animationTimer",value:function(){var e=this;window.requestAnimationFrame(function(){for(var t=0;t<e.aliveItems.length;t++){var n=e.aliveItems[t],r=n.getAttribute("data-speed"),i=n.getBoundingClientRect().left,a=n.getBoundingClientRect().width;if(n.style.transform="translateX(".concat(i-r,"px)"),i<-a){var u;(u=e.deatdItems).push.apply(u,o(e.aliveItems.splice(t,1))),e.notifyAddDom(),t--}}e.animationTimer()})}},{key:"checkOverlap",value:function(e){var t,n=d(this.aliveItems);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.getBoundingClientRect(),a=i.top,o=i.height;if(console.log(Math.abs(e-a)<o),Math.abs(e-a)<o)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"notifyAddDom",value:function(){if(!this.data.length)return this.emit("nodata");var e=this.data.shift(),t=this.deatdItems.shift(),n=t.querySelector("div"),r=t.querySelector("img");n.innerHTML=e.title,r.src=e.faceUrl,this.aliveItems.push(t),this.setDomPosition(t),this.setDomSpeed(t)}},{key:"on",value:function(e,t){w[e]=t}},{key:"emit",value:function(e){w[e]()}},{key:"appendData",value:function(e){this.data=e,this.notifyAddDom()}}]),e}(),S=function(){function e(){n(this,e)}return i(e,[{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.sort(function(n,r){switch(t){case 1:return n-r;case 2:return r-n;case 3:return Math.random()-.5;default:return e}})}},{key:"unique",value:function(e){if(Array.hasOwnProperty("from"))return Array.from(new Set(e));for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(t[e[r]]=!0,n.push(e[r]));return n}},{key:"union",value:function(e,t){var n=e.concat(t);return this.unique(n)}},{key:"intersect",value:function(e,t){return e=this.unique(e),e.map(function(e){return t.includes(e)?e:null})}},{key:"remove",value:function(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e}},{key:"formArray",value:function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}},{key:"max",value:function(e){return Math.max.apply(null,e)}},{key:"min",value:function(e){return Math.min.apply(null,e)}},{key:"sum",value:function(e){return e.reduce(function(e,t){return e+t})}},{key:"average",value:function(e){return this.sum(e)/e.length}}]),e}(),A=function(){function e(){n(this,e)}return i(e,[{key:"getAge",value:function(e){var t=new Date(e),n=new Date;return n.getFullYear()-t.getFullYear()-(n.getMonth()<t.getMonth()||n.getMonth()==t.getMonth()&&n.getDate()<t.getDate()?1:0)}}]),e}(),x=function(){function e(){n(this,e)}return i(e,[{key:"checkAppV1AndV2",value:function(e,t){var n=e.split("."),r=t.split("."),i=+n[0]-+r[0];return 0==i&&e!=t?this.checkAppV1AndV2(n.splice(1).join("."),r.splice(1).join(".")):i}},{key:"checkAppVersionIsOK",value:function(e,t){return!(this.checkAppV1AndV2(e,t)>0)}},{key:"isSamsung",value:function(e){return"sm-"==e.match(/sm-/i)}},{key:"isIPhone",value:function(e){return"iphone"==e.match(/iphone/i)}},{key:"softwareUpdate",value:function(e,t){var n=t.navigator?t.navigator.userAgent.toLowerCase():e,r=this.isSamsung(n),i=this.isIPhone(n);return r?(t.location.href="http://www.samsungapps.com/appquery/appDetail.as?appId=co.runner.app",!0):i?(t.location.href="https://apps.apple.com/cn/app/yue-pao-quan-yue-pao-yue-xiang/id881766160?l=zh&ls=1&mt=8",!0):(t.location.href="https://frontend-app.thejoyrun.com/release/joyrun.apk",!0)}},{key:"getUrlHost",value:function(e){var t=/^http(s)?:\/\/(.*?)\//;return e.match(t)[0]}},{key:"isCrossDomain",value:function(e,t){return this.getUrlHost(e)===this.getUrlHost(t)}}]),e}(),j={ImageService:g,DanmuService:k,ArrayFn:S,TimeFn:A,Os:x,Mime:v};e.ImageService=g,e.DanmuService=k,e.ArrayFn=S,e.TimeFn=A,e.Os=x,e.Mime=v,e.default=j,Object.defineProperty(e,"__esModule",{value:!0})});
