!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e["jrfe-utils"]={})}(this,function(e){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e){return a(e)||u(e)||s(e)||c()}function a(e){if(Array.isArray(e))return l(e)}function u(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}var d=function(){function e(){n(this,e)}return i(e,[{key:"getRemotePic",value:function(e,t,n){return new Promise(function(r,i){window.URL=window.URL||webkitURL;var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.send(),o.onload=function(e){var o=e.target,a=o.status,u=o.response;if(4===o.readyState&&200===a){var s=u,l=document.createElement("img");l.classList.add(t);var c=new FileReader;c.readAsDataURL(s),c.onloadend=function(){var e=c.result;"base64"===n?r(e):(l.src=e,r(l))}}else i(a)}}).catch(function(e){console.log("error>>>",e)})}}]),e}(),m={maxSpeed:10,minSpeed:3,spaceRatio:20,danmakuLength:5},h={},y=function(){function e(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n(this,e),"object"!==t(r))throw new Error("传入非法el");if(!i.length)return console.log("没有需要滚动的弹幕");this.option=Object.assign(m,o);var a=this.option.danmakuLength,u=r.getBoundingClientRect();this.$el=r,this.elWidth=u.width,this.elHeight=u.height,this.data=i,this.danmaku=i.splice(0,a),this.aliveItems=[],this.deatdItems=[],this.init()}return i(e,[{key:"init",value:function(){for(;this.danmaku.length;){var e=this.danmaku.shift(),t=this.createDom(e);this.aliveItems.push(t),this.$el.appendChild(t),this.setDomPosition(t),this.setDomSpeed(t)}this.animationTimer()}},{key:"createDom",value:function(e){var t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("img");return r.src=e.faceUrl,n.innerHTML=e.title,t.appendChild(r),t.appendChild(n),t}},{key:"setDomPosition",value:function(e){Math.random()>.5?e.setAttribute("class","danmaku-item one"):e.setAttribute("class","danmaku-item two");var t=e.getBoundingClientRect(),n=(t.width,t.height),r=this.option.spaceRatio,i=parseInt(Math.random()*((this.elHeight-n)/r)),o=i*r;e.style="top: ".concat(o,"px;transform: translateX(").concat(this.elWidth+50,"px)")}},{key:"setDomSpeed",value:function(e){var t=this.option,n=t.maxSpeed,r=t.minSpeed,i=parseInt(Math.random()*(n-r)+r),o=(this.elWidth/(60*i)).toFixed(3);e.setAttribute("data-speed",o)}},{key:"animationTimer",value:function(){var e=this;window.requestAnimationFrame(function(){for(var t=0;t<e.aliveItems.length;t++){var n=e.aliveItems[t],r=n.getAttribute("data-speed"),i=n.getBoundingClientRect().left,a=n.getBoundingClientRect().width;if(n.style.transform="translateX(".concat(i-r,"px)"),i<-a){var u;(u=e.deatdItems).push.apply(u,o(e.aliveItems.splice(t,1))),e.notifyAddDom(),t--}}e.animationTimer()})}},{key:"checkOverlap",value:function(e){var t,n=f(this.aliveItems);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.getBoundingClientRect(),o=i.top,a=i.height;if(console.log(Math.abs(e-o)<a),Math.abs(e-o)<a)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"notifyAddDom",value:function(){if(!this.data.length)return this.emit("nodata");var e=this.data.shift(),t=this.deatdItems.shift(),n=t.querySelector("div"),r=t.querySelector("img");n.innerHTML=e.title,r.src=e.faceUrl,this.aliveItems.push(t),this.setDomPosition(t),this.setDomSpeed(t)}},{key:"on",value:function(e,t){h[e]=t}},{key:"emit",value:function(e){h[e]()}},{key:"appendData",value:function(e){this.data=e,this.notifyAddDom()}}]),e}(),p=function(){function e(){n(this,e)}return i(e,[{key:"sort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.sort(function(n,r){switch(t){case 1:return n-r;case 2:return r-n;case 3:return Math.random()-.5;default:return e}})}},{key:"unique",value:function(e){if(Array.hasOwnProperty("from"))return Array.from(new Set(e));for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(t[e[r]]=!0,n.push(e[r]));return n}},{key:"union",value:function(e,t){var n=e.concat(t);return this.unique(n)}},{key:"intersect",value:function(e,t){var n=this;return e=this.unique(e),this.map(e,function(e){return n.contains(t,e)?e:null})}},{key:"remove",value:function(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e}},{key:"formArray",value:function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}},{key:"max",value:function(e){return Math.max.apply(null,e)}},{key:"min",value:function(e){return Math.min.apply(null,e)}},{key:"sum",value:function(e){return e.reduce(function(e,t){return e+t})}},{key:"average",value:function(e){return this.sum(e)/e.length}}]),e}(),v={ImageService:d,DanmuService:y,ArrayFn:p};e.ImageService=d,e.DanmuService=y,e.ArrayFn=p,e.default=v,Object.defineProperty(e,"__esModule",{value:!0})});
