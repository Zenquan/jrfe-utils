!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["jrfe-utils"]={})}(this,function(t){"use strict";function e(t){"@babel/helpers - typeof";return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t){return a(t)||s(t)||u(t)||c()}function a(t){if(Array.isArray(t))return l(t)}function s(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function u(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}var d=function(){function t(){n(this,t)}return o(t,[{key:"getRemotePic",value:function(t,e,n){return new Promise(function(i,o){window.URL=window.URL||webkitURL;var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.send(),r.onload=function(t){var r=t.target,a=r.status,s=r.response;if(4===r.readyState&&200===a){var u=s,l=document.createElement("img");l.classList.add(e);var c=new FileReader;c.readAsDataURL(u),c.onloadend=function(){var t=c.result;"base64"===n?i(t):(l.src=t,i(l))}}else o(a)}}).catch(function(t){console.log("error>>>",t)})}}]),t}(),m={maxSpeed:10,minSpeed:3,spaceRatio:20,danmakuLength:5},h={},p=function(){function t(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n(this,t),"object"!==e(i))throw new Error("传入非法el");if(!o.length)return console.log("没有需要滚动的弹幕");this.option=Object.assign(m,r);var a=this.option.danmakuLength,s=i.getBoundingClientRect();this.$el=i,this.elWidth=s.width,this.elHeight=s.height,this.data=o,this.danmaku=o.splice(0,a),this.aliveItems=[],this.deatdItems=[],this.init()}return o(t,[{key:"init",value:function(){for(;this.danmaku.length;){var t=this.danmaku.shift(),e=this.createDom(t);this.aliveItems.push(e),this.$el.appendChild(e),this.setDomPosition(e),this.setDomSpeed(e)}this.animationTimer()}},{key:"createDom",value:function(t){var e=document.createElement("div"),n=document.createElement("div"),i=document.createElement("img");return i.src=t.faceUrl,n.innerHTML=t.title,e.appendChild(i),e.appendChild(n),e}},{key:"setDomPosition",value:function(t){Math.random()>.5?t.setAttribute("class","danmaku-item one"):t.setAttribute("class","danmaku-item two");var e=t.getBoundingClientRect(),n=(e.width,e.height),i=this.option.spaceRatio,o=parseInt(Math.random()*((this.elHeight-n)/i)),r=o*i;t.style="top: ".concat(r,"px;transform: translateX(").concat(this.elWidth+50,"px)")}},{key:"setDomSpeed",value:function(t){var e=this.option,n=e.maxSpeed,i=e.minSpeed,o=parseInt(Math.random()*(n-i)+i),r=(this.elWidth/(60*o)).toFixed(3);t.setAttribute("data-speed",r)}},{key:"animationTimer",value:function(){var t=this;window.requestAnimationFrame(function(){for(var e=0;e<t.aliveItems.length;e++){var n=t.aliveItems[e],i=n.getAttribute("data-speed"),o=n.getBoundingClientRect().left,a=n.getBoundingClientRect().width;if(n.style.transform="translateX(".concat(o-i,"px)"),o<-a){var s;(s=t.deatdItems).push.apply(s,r(t.aliveItems.splice(e,1))),t.notifyAddDom(),e--}}t.animationTimer()})}},{key:"checkOverlap",value:function(t){var e,n=f(this.aliveItems);try{for(n.s();!(e=n.n()).done;){var i=e.value,o=i.getBoundingClientRect(),r=o.top,a=o.height;if(console.log(Math.abs(t-r)<a),Math.abs(t-r)<a)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"notifyAddDom",value:function(){if(!this.data.length)return this.emit("nodata");var t=this.data.shift(),e=this.deatdItems.shift(),n=e.querySelector("div"),i=e.querySelector("img");n.innerHTML=t.title,i.src=t.faceUrl,this.aliveItems.push(e),this.setDomPosition(e),this.setDomSpeed(e)}},{key:"on",value:function(t,e){h[t]=e}},{key:"emit",value:function(t){h[t]()}},{key:"appendData",value:function(t){this.data=t,this.notifyAddDom()}}]),t}();t.ImageService=d,t.DanmuService=p,Object.defineProperty(t,"__esModule",{value:!0})});
