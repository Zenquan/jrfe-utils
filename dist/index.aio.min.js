!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["jrfe-utils"]={})}(this,function(t){"use strict";function e(t){"@babel/helpers - typeof";return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t){return a(t)||u(t)||l(t)||c()}function a(t){if(Array.isArray(t))return s(t)}function u(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function l(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}var d=function(){function t(){n(this,t)}return i(t,[{key:"getRemotePic",value:function(t,e,n){return new Promise(function(r,i){window.URL=window.URL||webkitURL;var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="blob",o.send(),o.onload=function(t){var o=t.target,a=o.status,u=o.response;if(4===o.readyState&&200===a){var l=u,s=document.createElement("img");s.classList.add(e);var c=new FileReader;c.readAsDataURL(l),c.onloadend=function(){var t=c.result;"base64"===n?r(t):(s.src=t,r(s))}}else i(a)}}).catch(function(t){console.log("error>>>",t)})}}]),t}(),h={maxSpeed:10,minSpeed:3,spaceRatio:20,danmakuLength:5},m={},y=function(){function t(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n(this,t),"object"!==e(r))throw new Error("传入非法el");if(!i.length)return console.log("没有需要滚动的弹幕");this.option=Object.assign(h,o);var a=this.option.danmakuLength,u=r.getBoundingClientRect();this.$el=r,this.elWidth=u.width,this.elHeight=u.height,this.data=i,this.danmaku=i.splice(0,a),this.aliveItems=[],this.deatdItems=[],this.init()}return i(t,[{key:"init",value:function(){for(;this.danmaku.length;){var t=this.danmaku.shift(),e=this.createDom(t);this.aliveItems.push(e),this.$el.appendChild(e),this.setDomPosition(e),this.setDomSpeed(e)}this.animationTimer()}},{key:"createDom",value:function(t){var e=document.createElement("div"),n=document.createElement("div"),r=document.createElement("img");return r.src=t.faceUrl,n.innerHTML=t.title,e.appendChild(r),e.appendChild(n),e}},{key:"setDomPosition",value:function(t){Math.random()>.5?t.setAttribute("class","danmaku-item one"):t.setAttribute("class","danmaku-item two");var e=t.getBoundingClientRect(),n=(e.width,e.height),r=this.option.spaceRatio,i=parseInt(Math.random()*((this.elHeight-n)/r)),o=i*r;t.style="top: ".concat(o,"px;transform: translateX(").concat(this.elWidth+50,"px)")}},{key:"setDomSpeed",value:function(t){var e=this.option,n=e.maxSpeed,r=e.minSpeed,i=parseInt(Math.random()*(n-r)+r),o=(this.elWidth/(60*i)).toFixed(3);t.setAttribute("data-speed",o)}},{key:"animationTimer",value:function(){var t=this;window.requestAnimationFrame(function(){for(var e=0;e<t.aliveItems.length;e++){var n=t.aliveItems[e],r=n.getAttribute("data-speed"),i=n.getBoundingClientRect().left,a=n.getBoundingClientRect().width;if(n.style.transform="translateX(".concat(i-r,"px)"),i<-a){var u;(u=t.deatdItems).push.apply(u,o(t.aliveItems.splice(e,1))),t.notifyAddDom(),e--}}t.animationTimer()})}},{key:"checkOverlap",value:function(t){var e,n=f(this.aliveItems);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.getBoundingClientRect(),o=i.top,a=i.height;if(console.log(Math.abs(t-o)<a),Math.abs(t-o)<a)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"notifyAddDom",value:function(){if(!this.data.length)return this.emit("nodata");var t=this.data.shift(),e=this.deatdItems.shift(),n=e.querySelector("div"),r=e.querySelector("img");n.innerHTML=t.title,r.src=t.faceUrl,this.aliveItems.push(e),this.setDomPosition(e),this.setDomSpeed(e)}},{key:"on",value:function(t,e){m[t]=e}},{key:"emit",value:function(t){m[t]()}},{key:"appendData",value:function(t){this.data=t,this.notifyAddDom()}}]),t}(),p=function(){function t(){n(this,t)}return i(t,[{key:"contains",value:function(t,e){return-1!=t.indexOf(e)}},{key:"each",value:function(t,e){e=e||Function;for(var n=Array.prototype.slice.call(arguments,1),r=0;r<t.length;r++){e.apply(t,[t[r],r].concat(n))}}},{key:"map",value:function(t,e,n){for(var r=n||window,i=[],o=0,a=t.length;o<a;++o){var u=e.call(r,t[o],o,this);null!=u&&i.push(u)}return i}},{key:"sort",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.sort(function(n,r){switch(e){case 1:return n-r;case 2:return r-n;case 3:return Math.random()-.5;default:return t}})}},{key:"unique",value:function(t){if(Array.hasOwnProperty("from"))return Array.from(new Set(t));for(var e={},n=[],r=0;r<t.length;r++)e[t[r]]||(e[t[r]]=!0,n.push(t[r]));return n}},{key:"union",value:function(t,e){var n=t.concat(e);return this.unique(n)}},{key:"intersect",value:function(t,e){var n=this;return t=this.unique(t),this.map(t,function(t){return n.contains(e,t)?t:null})}},{key:"remove",value:function(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t}},{key:"formArray",value:function(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}},{key:"max",value:function(t){return Math.max.apply(null,t)}},{key:"min",value:function(t){return Math.min.apply(null,t)}},{key:"sum",value:function(t){return t.reduce(function(t,e){return t+e})}},{key:"average",value:function(t){return this.sum(t)/t.length}}]),t}();t.ImageService=d,t.DanmuService=y,t.ArrayFn=p,Object.defineProperty(t,"__esModule",{value:!0})});
